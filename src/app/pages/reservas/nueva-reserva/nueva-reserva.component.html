<div class="reserva-container">
  <!-- Mensaje de Ã‰xito -->
  @if (exito) {
    <div class="success-modal">
      <div class="success-content">
        <span class="success-icon">âœ…</span>
        <h2>Â¡Reserva Confirmada!</h2>
        <p>Tu reserva ha sido creada exitosamente</p>
        <p class="redirect-msg">Redirigiendo a tus reservas...</p>
      </div>
    </div>
  }

  @if (!exito) {
    <div class="content-wrapper">
    <div class="header-section">
      <button class="btn-back" (click)="cancelar()">â† Volver</button>
      <h1>Nueva Reserva</h1>
      <p class="subtitle">Completa los datos para tu estadÃ­a</p>
    </div>

    @if (departamento && !cargando) {
      <div class="reserva-grid">
      <!-- Formulario de Reserva -->
      <div class="form-section">
        <div class="card">
          <h2>ğŸ“… InformaciÃ³n de la Reserva</h2>

          @if (error) {
            <div class="alert alert-error">
              âš ï¸ {{ error }}
            </div>
          }

          <form class="reserva-form">
            <div class="form-row">
              <div class="form-group">
                <label for="fechaInicio">Fecha de Entrada *</label>
                <input
                  type="date"
                  id="fechaInicio"
                  [(ngModel)]="fechaInicio"
                  name="fechaInicio"
                  [min]="fechaInicio"
                  required
                  (change)="editarFechas()"
                />
              </div>

              <div class="form-group">
                <label for="fechaFin">Fecha de Salida *</label>
                <input
                  type="date"
                  id="fechaFin"
                  [(ngModel)]="fechaFin"
                  name="fechaFin"
                  [min]="fechaInicio"
                  required
                  (change)="editarFechas()"
                />
              </div>
            </div>

            <div class="form-group">
              <label for="numeroPersonas">NÃºmero de Personas *</label>
              <div class="number-input">
                <button
                  type="button"
                  class="btn-number"
                  (click)="numeroPersonas = numeroPersonas > 1 ? numeroPersonas - 1 : 1"
                >
                  -
                </button>
                <input
                  type="number"
                  id="numeroPersonas"
                  [(ngModel)]="numeroPersonas"
                  name="numeroPersonas"
                  [min]="1"
                  [max]="departamento.capacidadPersonas"
                  required
                />
                <button
                  type="button"
                  class="btn-number"
                  (click)="numeroPersonas = numeroPersonas < departamento.capacidadPersonas ? numeroPersonas + 1 : departamento.capacidadPersonas"
                >
                  +
                </button>
              </div>
              <small>Capacidad mÃ¡xima: {{ departamento.capacidadPersonas }} personas</small>
            </div>

            <div class="form-group">
              <label for="observaciones">Observaciones (opcional)</label>
              <textarea
                id="observaciones"
                [(ngModel)]="observaciones"
                name="observaciones"
                rows="4"
                placeholder="Escribe cualquier solicitud especial..."
              ></textarea>
            </div>

            @if (!mostrarResumen) {
              <button
                type="button"
                class="btn-verificar"
                (click)="verificarDisponibilidad()"
                [disabled]="verificando || !fechaInicio || !fechaFin"
              >
                @if (!verificando) {
                  <span>Verificar Disponibilidad</span>
                }
                @if (verificando) {
                  <span>Verificando...</span>
                }
              </button>
            }
          </form>
        </div>

        <!-- Resumen de Reserva -->
        @if (mostrarResumen && disponible) {
          <div class="card resumen-card">
          <h2>ğŸ“‹ Resumen de tu Reserva</h2>

          <div class="resumen-item">
            <span class="label">ğŸ“… Entrada:</span>
            <span class="value">{{ formatearFecha(fechaInicio) }}</span>
          </div>

          <div class="resumen-item">
            <span class="label">ğŸ“… Salida:</span>
            <span class="value">{{ formatearFecha(fechaFin) }}</span>
          </div>

          <div class="resumen-item">
            <span class="label">ğŸŒ™ Noches:</span>
            <span class="value">{{ numeroNoches }} noche(s)</span>
          </div>

          <div class="resumen-item">
            <span class="label">ğŸ‘¥ Personas:</span>
            <span class="value">{{ numeroPersonas }} persona(s)</span>
          </div>

          <div class="divider"></div>

          <div class="resumen-item">
            <span class="label">Subtotal:</span>
            <span class="value">{{ formatearMoneda(subtotal) }}</span>
          </div>

          <div class="resumen-item">
            <span class="label">Impuestos (12%):</span>
            <span class="value">{{ formatearMoneda(impuestos) }}</span>
          </div>

          <div class="resumen-item total">
            <span class="label">Total:</span>
            <span class="value">{{ formatearMoneda(total) }}</span>
          </div>

          <div class="resumen-actions">
            <button
              type="button"
              class="btn-secondary"
              (click)="editarFechas()"
            >
              Editar Fechas
            </button>
            <button
              type="button"
              class="btn-primary"
              (click)="confirmarReserva()"
              [disabled]="cargando"
            >
              @if (!cargando) {
                <span>âœ“ Confirmar Reserva</span>
              }
              @if (cargando) {
                <span>âœ“ Confirmar Reserva</span>
              }
              @if (cargando) {
                <span>Procesando...</span>
              }
            </button>
          </div>
          </div>
        }
      </div>

      <!-- InformaciÃ³n del Departamento -->
      <div class="depto-info-card">
        <div class="card">
          <div class="depto-header">
            <img
              [src]="departamento.imagenes && departamento.imagenes.length > 0 ? departamento.imagenes[0].url : 'assets/placeholder-room.svg'"
              [alt]="'HabitaciÃ³n ' + departamento.numero"
              class="depto-imagen"
            />
            <div class="badge-tipo">{{ departamento.tipo | titlecase }}</div>
          </div>

          <div class="depto-content">
            <h3>HabitaciÃ³n {{ departamento.numero }}</h3>
            <p class="descripcion">{{ departamento.descripcion || 'HabitaciÃ³n cÃ³moda y equipada' }}</p>

            <div class="depto-detalles">
              <div class="detalle">
                <span class="icon">ğŸ‘¥</span>
                <span>{{ departamento.capacidadPersonas }} personas</span>
              </div>
              <div class="detalle">
                <span class="icon">ğŸ›ï¸</span>
                <span>{{ departamento.numeroCamas }} cama(s)</span>
              </div>
              <div class="detalle">
                <span class="icon">ğŸ¢</span>
                <span>Piso {{ departamento.piso }}</span>
              </div>
            </div>

            <div class="precio-noche">
              <span class="precio">{{ formatearMoneda(departamento.precioNoche) }}</span>
              <span class="periodo">/ noche</span>
            </div>

            <div class="amenidades">
              <h4>Comodidades:</h4>
              <div class="amenidades-list">
                @if (departamento.caracteristicas.wifi) {
                  <span>ğŸ“¶ WiFi</span>
                }
                @if (departamento.caracteristicas.televisor) {
                  <span>ğŸ“º TV</span>
                }
                @if (departamento.caracteristicas.aireAcondicionado) {
                  <span>â„ï¸ A/C</span>
                }
                @if (departamento.caracteristicas.minibar) {
                  <span>ğŸ§Š Minibar</span>
                }
                @if (departamento.caracteristicas.balcon) {
                  <span>ğŸŒ¿ BalcÃ³n</span>
                }
                @if (departamento.caracteristicas.banoPrivado) {
                  <span>ğŸš¿ BaÃ±o</span>
                }
              </div>
            </div>
          </div>
        </div>

        <div class="card politicas-card">
          <h4>ğŸ“‹ PolÃ­ticas de Reserva</h4>
          <ul>
            <li>âœ“ Check-in: 14:00 hrs</li>
            <li>âœ“ Check-out: 12:00 hrs</li>
            <li>âœ“ CancelaciÃ³n gratuita 24h antes</li>
            <li>âœ“ ConfirmaciÃ³n inmediata</li>
          </ul>
        </div>
      </div>
      </div>
    }

    <!-- Loading State -->
    @if (cargando) {
      <div class="loading">
        <div class="spinner"></div>
        <p>Cargando informaciÃ³n...</p>
      </div>
    }
    </div>
  }
</div>
