<div class="pagar-container">
  <!-- Header -->
  <div class="header">
    <button class="btn-volver" (click)="volver()">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
      </svg>
      Volver
    </button>
    <h1>Pagar Factura</h1>
  </div>

  <!-- Mensaje de carga -->
  <div *ngIf="cargando" class="loading">
    <div class="spinner"></div>
    <p>Cargando informaci√≥n...</p>
  </div>

  <!-- Contenido principal -->
  <div *ngIf="!cargando && factura" class="contenido">
    <!-- Informaci√≥n de la factura -->
    <div class="info-factura">
      <h2>Informaci√≥n de la Factura</h2>
      <div class="info-grid">
        <div class="info-item">
          <span class="label">N¬∞ Factura:</span>
          <span class="value">{{ factura.numeroFactura }}</span>
        </div>
        <div class="info-item">
          <span class="label">Cliente:</span>
          <span class="value">{{ getClienteNombre() }}</span>
        </div>
        <div class="info-item">
          <span class="label">Reserva:</span>
          <span class="value">{{ getReservaCodigoReserva() }}</span>
        </div>
        <div class="info-item">
          <span class="label">Total:</span>
          <span class="value">{{ formatearMoneda(factura.total) }}</span>
        </div>
        <div class="info-item">
          <span class="label">Monto a Pagar:</span>
          <span class="value destacado">{{ formatearMoneda(calcularMontoPendiente()) }}</span>
        </div>
      </div>
    </div>

    <!-- Mensaje de √©xito -->
    <div *ngIf="exito" class="mensaje-exito">
      <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
        <polyline points="22 4 12 14.01 9 11.01"></polyline>
      </svg>
      <h3>¬°Pago Exitoso!</h3>
      <p>Tu pago ha sido procesado correctamente. Ser√°s redirigido a tus facturas...</p>
    </div>

    <!-- Alerta de proyecto universitario -->
    <div class="alerta-universitario" *ngIf="!exito">
      <div class="icono-alerta">‚ö†Ô∏è</div>
      <div class="texto-alerta">
        <strong>PROYECTO UNIVERSITARIO - MODO PRUEBA</strong>
        <p>Este es un sistema de pagos ficticio. Usa las tarjetas de prueba mostradas abajo.</p>
      </div>
    </div>

    <!-- Formulario de pago -->
    <div class="formulario-pago" *ngIf="!exito">
      <h2>Informaci√≥n de Pago</h2>
      
      <!-- Formulario simulado de tarjeta -->
      <div class="card-element-container" *ngIf="paymentIntentId.startsWith('pi_test_')">
        <label>Tarjeta de Cr√©dito/D√©bito (Simulaci√≥n)</label>
        <div class="formulario-tarjeta-simulado">
          <div class="campo">
            <label>Nombre del titular</label>
            <input 
              type="text" 
              placeholder="NOMBRE APELLIDO" 
              [(ngModel)]="nombreTitular"
              class="input-tarjeta input-activo"
              [class.input-error]="error"
            >
          </div>
          <div class="campo">
            <label>N√∫mero de tarjeta</label>
            <input 
              type="text" 
              placeholder="4242 4242 4242 4242" 
              maxlength="19"
              [(ngModel)]="numeroTarjeta"
              (input)="formatearNumeroTarjeta($event)"
              class="input-tarjeta input-activo"
              [class.input-error]="error"
            >
          </div>
          <div class="campos-row">
            <div class="campo">
              <label>Fecha de expiraci√≥n</label>
              <input 
                type="text" 
                placeholder="MM/AA" 
                maxlength="5"
                [(ngModel)]="fechaExpiracion"
                (input)="formatearFechaExpiracion($event)"
                class="input-tarjeta input-activo"
                [class.input-error]="error"
              >
            </div>
            <div class="campo">
              <label>CVV</label>
              <input 
                type="text" 
                placeholder="123" 
                maxlength="4"
                [(ngModel)]="cvv"
                class="input-tarjeta input-activo"
                [class.input-error]="error"
              >
            </div>
          </div>
          <p class="nota-simulacion">üí≥ Usa las tarjetas de prueba de abajo para simular diferentes resultados</p>
        </div>
      </div>

      <!-- Elemento de Stripe (solo si no es simulaci√≥n) -->
      <div class="card-element-container" *ngIf="!paymentIntentId.startsWith('pi_test_')">
        <label>Tarjeta de Cr√©dito/D√©bito</label>
        <div id="card-element" class="card-element"></div>
      </div>

      <!-- Error -->
      <div *ngIf="error" class="mensaje-error">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        {{ error }}
      </div>

      <!-- Bot√≥n de pago -->
      <button 
        class="btn-pagar" 
        (click)="procesarPago()"
        [disabled]="procesandoPago || !paymentIntentId"
      >
        <span *ngIf="!procesandoPago">
           Pagar {{ formatearMoneda(calcularMontoPendiente()) }}
        </span>
        <span *ngIf="procesandoPago">
          <div class="spinner-small"></div>
          Procesando pago...
        </span>
      </button>

      <!-- Tarjetas de prueba -->
      <div class="tarjetas-prueba">
        <div class="tarjetas-header">
          <h3>Tarjetas de Prueba</h3>
          <p>Copia estos n√∫meros para probar diferentes escenarios</p>
        </div>
        
        <div class="lista-tarjetas">
          <div class="tarjeta-item exito">
            <div class="tarjeta-tipo">‚úÖ Visa - Pago Exitoso</div>
            <div class="tarjeta-numero">4242 4242 4242 4242</div>
            <div class="tarjeta-info">
              <span>Fecha: Cualquier futura</span>
              <span>CVV: Cualquier 3 d√≠gitos</span>
            </div>
          </div>
          
          <div class="tarjeta-item exito">
            <div class="tarjeta-tipo">‚úÖ Mastercard - Pago Exitoso</div>
            <div class="tarjeta-numero">5555 5555 5555 4444</div>
            <div class="tarjeta-info">
              <span>Fecha: Cualquier futura</span>
              <span>CVV: Cualquier 3 d√≠gitos</span>
            </div>
          </div>
          
          <div class="tarjeta-item error">
            <div class="tarjeta-tipo">‚ùå Tarjeta Rechazada</div>
            <div class="tarjeta-numero">4000 0000 0000 0002</div>
            <div class="tarjeta-info">
              <span>Resultado: Rechazada por el banco</span>
            </div>
          </div>
          
          <div class="tarjeta-item error">
            <div class="tarjeta-tipo">‚ùå Fondos Insuficientes</div>
            <div class="tarjeta-numero">4000 0000 0000 9995</div>
            <div class="tarjeta-info">
              <span>Resultado: Sin fondos suficientes</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Seguridad -->
      <div class="seguridad-info">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
        </svg>
        <span>Pago seguro procesado por Stripe</span>
      </div>
    </div>
  </div>
</div>
