import{a}from"./chunk-OIQRXGYA.js";import{Da as p,e as n,i as r,l as o,o as u}from"./chunk-JGLOSZAI.js";var l=class i{constructor(t){this.http=t;let e=this.getUserFromStorage();this.currentUserSubject=new n(e),this.currentUser=this.currentUserSubject.asObservable()}apiUrl=a.apiUrl;currentUserSubject;currentUser;tokenKey="auth_token_cliente";get currentUserValue(){return this.currentUserSubject.value}get token(){return localStorage.getItem(this.tokenKey)}login(t){return this.http.post(`${this.apiUrl}/auth/login`,t).pipe(r(e=>{e.success&&e.data&&this.setSession(e.data.usuario,e.data.token)}))}verify2FA(t,e){return this.http.post(`${this.apiUrl}/auth/verify-2fa`,{userId:t,token:e}).pipe(r(s=>{s.success&&s.data&&this.setSession(s.data.usuario,s.data.token)}))}register(t){return this.http.post(`${this.apiUrl}/auth/register`,t).pipe(r(e=>{e.success&&e.data&&this.setSession(e.data.usuario,e.data.token)}))}logout(){localStorage.removeItem(this.tokenKey),localStorage.removeItem("current_user_cliente"),this.currentUserSubject.next(null)}getMe(){return this.http.get(`${this.apiUrl}/auth/me`).pipe(r(t=>{t.success&&t.data&&(this.currentUserSubject.next(t.data),this.saveUserToStorage(t.data))}))}cambiarPassword(t,e){return this.http.put(`${a.apiUrl}/usuarios/cambiar-password`,{passwordActual:t,passwordNueva:e})}habilitar2FA(){return this.http.post(`${this.apiUrl}/auth/enable-2fa`,{})}verificar2FAConfig(t){return this.http.post(`${this.apiUrl}/auth/confirm-2fa`,{token:t})}deshabilitar2FA(){return this.http.post(`${this.apiUrl}/auth/disable-2fa`,{})}enable2FA(){return this.http.post(`${this.apiUrl}/auth/enable-2fa`,{})}confirm2FA(t){return this.http.post(`${this.apiUrl}/auth/confirm-2fa`,{token:t})}disable2FA(t){return this.http.post(`${this.apiUrl}/auth/disable-2fa`,{password:t})}isAuthenticated(){return!!this.token}setSession(t,e){localStorage.setItem(this.tokenKey,e),this.saveUserToStorage(t),this.currentUserSubject.next(t)}saveUserToStorage(t){localStorage.setItem("current_user_cliente",JSON.stringify(t))}getUserFromStorage(){let t=localStorage.getItem("current_user_cliente");if(t)try{return JSON.parse(t)}catch{return null}return null}static \u0275fac=function(e){return new(e||i)(u(p))};static \u0275prov=o({token:i,factory:i.\u0275fac,providedIn:"root"})};export{l as a};
